language: ruby
rvm:
- 2.4.1
env:
  global:
  - APP_ENV=production
  - DB_CONNECTION=$DB_CONNECTION
before_script:
- bundle exec rails db:create
- bundle exec rails db:migrate
- bundle exec rails db:seed
script: bundle exec rails test
services: postgresql
stages:
- name: deploy
  if: branch = master
deploy:
  provider: heroku
  api_key:
    secure: UgebS63ZzaZf0woI+E94TYFlz2ptshxxczUi1eIqO3d3pgVCbcLD3bK+MMXwa3pJk3z9JLb/gV6M2XOmCJ5eQgd5eFre7LxAF0dpS3EgPsL7TpqEZozkFml84y54I5Rm1eiW8ARc9Z7jXCU1Q/3ragO8rJyp1vMDozbhivHPoti0QDdeRvKZkwtw3eCrxU539I7jJd9XraToKajDP6HuOzWuvDp8ofXEon5TyQzPhSzYoPgshz8+giXDAwCoXCElWXvnQSxh88zrO2m71GIdYdRCAWo2CF6WiI5JcWHA5Jzzr2o9+9p7/SmwGDgAeHcxlHDkjFjElkn97ICvnqwz6xjBEGojVOXI8zWucxmwewN0jBCbaE7X0zi1EjMo2ac/WnHKjJ81Q31alv1JKeOWd0yR2bGj+MLyE/HDKP/YfXudXXzHOzUn/gAjrHah0BtktqulrRwipJ8FV0Oz4xNmhIX6oblQmzZo/iiEeQq3hqdkgU+GgoV3P9HUpKo52C+DDArt5IdZpyV8c/dacFR7k+ORN2/aLee3UMUGVDRsqznhrfBoVtyEjvrRBQuKXHRyWph+0coMRZzxwiKDwHAdD9lWcgeAvn/fGYJNecoI3qzly2r6OONFFhwLUJKaZD6dB+UoAyVK8RmpTSmcikZWYHceaEyi1uQr7W4dnu57gf4=
  app: tfgbackend0
  run:
  - rake db:migrate
  - rake db:seed
